
Is this the day I figure out what is wrong about my model ?
===========================================================

:date: 2016-04-21


Probably not !

I needed a win today so I wrote some tangentially related code. I now have a script that will move subplots closer to one another in a figure to better use the available space. 

Onto figuring out the problem with the model. I know that the basic pitch-rate model is ok. I know that I have no idea what the mixer value should be or even if it looks anything like it should. I can also assume that my PIDs are Ok. I mean how can I fuck writing a PID ? I checked and double checked and it's OK. What am I missing ?

Time to do some old fashioned maths ... The loop transfer function of the system is: 

.. math:: 

    \begin{aligned}
        L(s) &= R_i(s) \cdot \chi \cdot G(s) \\
             &= \frac{30.3 s + 30}{s + 100} \cdot \chi \cdot \frac{0.4323}{s + 1} \\
             &= \chi \cdot \frac{13.0987 s + 12.969}{(s + 100)(s + 1.33)} \\
             &\approx 13 \chi \cdot \frac{s + 1}{(s + 100)(s + 1.33)}
    \end{aligned}

The zero in :math:`s = -1` roughly cancels the pole in :math:`s = -1.33` so a dominant poles approximation of the system is:

.. math::

    L(s) = \mu \cdot \frac{1}{s + 100}

This matches perfectly with the bode plot for the inner loop:

.. figure:: {filename}static/04-21/inner_loop_bode_plot.png
    :alt: Bode plot of the inner loop of the control system

    Bode plot of the inner loop (PD) of the control system (``bode(InnerLoop.Li)``)

Everything else is fucked up. Nothing is working.

I know that: 

#. The ``PitchRateModel`` is correct.
#. The Mixer is constant because on page 88 is does not have a dependence on :math:`s`
#. The expressions of the :math:`PD` and :math:`PID` controllers are correct
#. The bandwidths of the inner and outer loops are coherent. 
   
        .. code-block:: matlab

            >> bandwidth(InnerReferenceModel)
            ans =
                 1.0390e+003
            >> bandwidth(OuterReferenceModel)
            ans =
                 1.8489e+000

I have located the following graphs in the thesis that might be useful: 

#. Figure 7.5, I assume it shows the complementary sensitivity of the outer loop
   
The complementary sensitivity of my outer loop is shown here:

.. figure:: {filename}static/04-21/outer_loop_compl_sens_bode_plot.png
    :align: center
    :alt: Complementary sensitivity of my outer loop

    Complementary sensitivity of my outer loop. Figure 7.5 of the thesis shows a function with a single pole around :math:`s = 1`. Mine has a pole and zero close to 1 that cancel each other out as well as a complex pole in 1 that leaves us with a a slope of -2 !




