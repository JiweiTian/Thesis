<!DOCTYPE html>
<html lang="">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" 
          content="    
">
    <meta name="author" content="Tibo">

    <title>    The VRFT Technique â€” Thesis Log 
</title>

    <!-- Bootstrap Core CSS, Code Highlighting -->
    <link href="/theme/css/bootstrap.min.css" rel="stylesheet">
    <link href="/theme/css/pygments.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="/theme/css/theme.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <header class="clearfix"> 
        <section class="row">  	
            <h1 class="col-lg-8 col-lg-offset-2">
                <a href="" class="title-link">Thesis Log</a>
                <br>
                    <small class="subtitle"> Keeping myself in check</small>
            </h1>
        </section>

        <section class="row clearfix">
            <ul class="col-lg-8 col-lg-offset-2 list-unstyled">
                <li class="h5 pull-right">
                    <a href="/pages/cascade-vrft.html">Cascade VRFT</a>
                </li>
                <li class="h5 pull-right">
                    <a href="/pages/the-vrft-technique.html">The VRFT Technique</a>
                </li>
            </ul>
        </section>
    </header>

    <!-- Page Content -->
    <div class="container clearfix">

        <div class="row">
               
            <!-- Blog Post Content Column -->
            <div class="col-lg-8 col-lg-offset-2">
        
<article id="content" class="post-content">    
    <p><strong>V</strong>irtual <strong>R</strong>eference <strong>F</strong>eedback <strong>T</strong>uning is a data driven method to design a controller for an unknown plant based on input/output measurements. The method can be applied using a single set of input/output data generated by the plant without the need for specific experiments or model identification.</p>
<div class="section" id="how-does-it-work">
<h2>How Does It Work ?</h2>
<p>To use VRFT we need:</p>
<ul class="simple">
<li>a reference model, a model that describes the ideal behaviour of the closed loop system.</li>
<li>one set of input-output data on the plant. The input does not need to have any special characteristics.</li>
</ul>
<div class="figure align-center" style="width: 1282px; height: auto; max-width: 100%;">
<img alt="The block diagram of VRFT" src="/static/pages/about-vrft/vrft_block_diagram.png" style="width: 1282px; height: auto; max-width: 100%;"/>
<p class="caption">Block diagram showing the closed loop control system and the reference model.</p>
<div class="legend">
Note that the output of the reference model and the control loop are identical.</div>
</div>
<p>Since the output <span class="math">\(y(t)\)</span> is known we can calculate an input signal <span class="math">\(r(t)\)</span> such that:</p>
<div class="math">
\begin{equation*}
y(t) = M_R(z) r(t)
\end{equation*}
</div>
<p>This signal is the <em>virtual reference</em>. Using this virtual reference we can calculate the input to the controller:</p>
<div class="math">
\begin{equation*}
e(t) = r(t) - y(t)
\end{equation*}
</div>
<p>Now that both the input and the output (<span class="math">\(u(t)\)</span>) of the controller are known the control problem can be reduced to an identification problem.</p>
</div>
<div class="section" id="a-more-rigorous-approach">
<h2>A More Rigorous approach</h2>
<p>It is assumed that the plant is a <em>linear</em> SISO discrete-time dynamical system described by a rational transfer function (<span class="math">\(P(z)\)</span>).</p>
<p>We choose a reference model <span class="math">\(M_R(z)\)</span> that describes the desired behaviour of the closed loop control system.</p>
<p>We determine a class of controllers <span class="math">\(C(z; \theta)\)</span> that depend linearly on the parameter vector <span class="math">\(\theta\)</span> such that:</p>
<div class="math">
\begin{equation*}
C(z; \theta) = \beta(z)^T\theta^T
\end{equation*}
</div>
<p>Where:</p>
<ul class="simple">
<li><span class="math">\(\beta = [\beta_1(z), \beta_2(z), ..., \beta_n(z)]^T\)</span> is a vector of linear transfer functions</li>
<li><span class="math">\(\theta = [\theta_1, \theta_2, ... \theta_n]^T\)</span> is the vector of parameters</li>
</ul>
<p>The control objective is the minimisation of the following criterion:</p>
<div class="math">
\begin{equation*}
\begin{aligned}
    J_{MR}(\theta) &amp;= \left| \left( \frac{P(z)C(z; \theta)}{1 + P(z)C(z; \theta)} - M(z) \right) W(z) \right|_2^2 \\
                   &amp;= \left| \left( T(z) - M(z) \right) W(z) \right|_2^2
\end{aligned}
\end{equation*}
</div>
<p>which is equivalent to minimising the difference between the closed loop system scaled by an appropriate weighting function. The choice of <span class="math">\(W(z)\)</span> is up to the system designer and can be chosen to emphasize or de-emphasize performance in certain frequency bands.</p>
<p>An optimal choice of <span class="math">\(C(z; \theta)\)</span> will produce a closed loop system whose transfer function is <span class="math">\(M(z)\)</span>. Thus, if the closed-loop system is fed a reference signal <span class="math">\(r(t)\)</span> its output will be :</p>
<div class="math">
\begin{equation*}
y(t) = T(z)r(t) = M(z)r(t)
\end{equation*}
</div>
<p>The VRFT method works by using the measured output (<span class="math">\(y(t)\)</span>) to generate a reference signal <span class="math">\(\bar{r}(t)\)</span> such that:</p>
<div class="math">
\begin{equation*}
M(z)\bar{r}(t) = y(t)
\end{equation*}
</div>
<p>This is our so-called <em>virtual</em> reference, it does not exist in the physical world and is only used a tool to generate the optimal controller. The input of the controller is:</p>
<div class="math">
\begin{equation*}
e(t) = \bar{r}(t) - y(t)
\end{equation*}
</div>
<p>The optimal controller must be such that when fed the virtual reference it produces the measured input (<span class="math">\(u(t)\)</span>). Thus:</p>
<div class="math">
\begin{equation*}
u(t) = C(z; \hat{\theta}) \bar{r}(t)
\end{equation*}
</div>
<p>Where <span class="math">\(\hat{\theta}\)</span> is the optimal parameter vector.</p>
<p>To calculate the optimal parameter vector we can start by attempting to solve a slightly easier problem. Apply a filter <span class="math">\(L(t)\)</span> to the data. We will explain the reason for this filter soon but bear with me in the meantime.</p>
<div class="math">
\begin{equation*}
e_L(t) = L(z)e(t) \quad, \quad y_L(t) = L(z)e(t)
\end{equation*}
</div>
<p>Now, consider the following performance index:</p>
<div class="math">
\begin{equation*}
\begin{aligned}
    J^N_{VR}(\theta) &amp;= \frac{1}{N} \sum_{t=1}^{N} \left( u_L(t) - C(z; \theta) \ e_L(t) \right)^2 \\
                     &amp;= \frac{1}{N} \sum_{t=1}^{N}\left( u_L(t) - \beta^T(z)\theta \ e_L(t) \right)^2 \\
                     &amp;= \frac{1}{N} \sum_{t=1}^{N}\left( u_L(t) - \varphi_L^T(t)\theta \right)^2, \quad \varphi_L = \beta^T(z) \  e_L(t)
\end{aligned}
\end{equation*}
</div>
<p>Since this equation is quadratic in <span class="math">\(\theta\)</span> the optimal value <span class="math">\(\hat{\theta}_N\)</span> is an explicit function of the data:</p>
<div class="math">
\begin{equation*}
\hat{\theta}_N = \left[ \sum_t \phi(t) \phi(t)^T \right]^{-1} \sum_t \phi(t)u(t)
\end{equation*}
</div>
<p>However, we still haven't solved the original problem of minimising <span class="math">\(J_{MR}\)</span>. This method though is useful because it is based purely on the data and is relatively easy to compute.</p>
<p>Before continuing we need to make a digression. Let's rewrite <span class="math">\(J_{MR}\)</span> in the frequency domain</p>
<div class="math">
\begin{equation*}
\begin{aligned}
    J_{MR}(\theta) &amp;= \frac{1}{2 \pi} \cdot \int_{-\pi}^{\pi} \left| \frac{PC(\theta)}{1 + PC(\theta)} - M \right|^2 \left| W \right|^2 d\omega \\
                   &amp;= \frac{1}{2 \pi} \cdot \int_{-\pi}^{\pi} \left| \frac{PC(\theta)}{1 + PC(\theta)} - \frac{PC_0}{1 + PC_0} \right|^2 \left| W \right|^2 d\omega \\
                   &amp;= \frac{1}{2 \pi} \cdot \int_{-\pi}^{\pi} \left| \frac{PC(\theta)[1 + PC_0]     - PC_0[1 + PC(\theta)]}{[1 + PC(\theta)][1 + PC_0]} \right|^2 \left| W \right|^2 d\omega \\
                   &amp;= \frac{1}{2 \pi} \cdot \int_{-\pi}^{\pi} \left| P \cdot \frac{C(\theta) - C_0}{[1 + PC(\theta)][1 + PC_0]} \right|^2 \left| W \right|^2 d\omega \\
\end{aligned}
\end{equation*}
</div>
<p>We can now go back to <span class="math">\(J_{VR}\)</span>.</p>
<!-- math:.


J^N_{VR}(\theta) &= \frac{1}{N} \sum_{t=1}^{N} \left( u_L(t) - C(z; \theta) \ e_L(t) \right)^2 -->
<p>If <span class="math">\(u(t)\)</span> and <span class="math">\(y(t)\)</span> can be considered realisations of stationary stochastic processes then as the amount of data grows (<span class="math">\(N \rightarrow \infty\)</span>) the following holds:</p>
<div class="math">
\begin{equation*}
J^N_{VR}(\theta) \rightarrow J_{VR}(\theta)
\end{equation*}
</div>
<p>And:</p>
<div class="math">
\begin{equation*}
\begin{aligned}
    J_{VR}(\theta) &amp;= E \left[ \left( u_L(t) - C(z; \theta)e_L(t) \right)^2 \right] \\
                   &amp;= E \left[ L(z) \cdot \left( u(t) - C(z; \theta)e(t) \right)^2 \right]
\end{aligned}
\end{equation*}
</div>
<p>We would like to get rid of <span class="math">\(e(t)\)</span> in the equation to make it depend only on our initial data:</p>
<div class="math">
\begin{equation*}
e(t) = \bar{r}(t) - y(t) = \bar{r}(t) - M_R(z)\bar{r}(t) = \left( 1 - M_R(z) \right) \cdot \bar{r}(t)
\end{equation*}
</div>
<p>And since:</p>
<div class="math">
\begin{equation*}
r(t) = \frac{y(t)}{M_R} = \frac{P}{M_R} \cdot u(t)
\end{equation*}
</div>
<p>We can rewrite the criterion as:</p>
<div class="math">
\begin{equation*}
\begin{aligned}
    J^N_{VR}(\theta) &amp;= \frac{1}{N} \sum_{t=1}^{N} \left[u_L(t) - C(z; \theta) \cdot \left( 1 - M_R(z) \right) \cdot \frac{P}{M_R} \cdot u_L(t) \right]^2 \\
                     &amp;= \frac{1}{N} \sum_{t=1}^{N} \left[ \left( L(z) \left( 1 - C(z; \theta) \cdot \frac{1 - M_R(z)}{M_R(z)} \cdot P \right) u_L(t)\right)^2 \right]
\end{aligned}
\end{equation*}
</div>
<p>We also know that, by definition, <span class="math">\(M_R\)</span> is:</p>
<div class="math">
\begin{equation*}
M_R(z) = \frac{PC_0}{1 + PC_0} \quad \Rightarrow \quad 1 - M_R = \frac{1 + PC_0 - PC_0}{1 + PC_0} = \frac{1}{1 + PC_0}
\end{equation*}
</div>
<p>Which brings us to:</p>
<div class="math">
\begin{equation*}
\begin{aligned}
    1 - C(\theta) \cdot \frac{1 - M_R}{M_R} \cdot P &amp;= \frac{1}{M_R} \left( M_R - PC(\theta) \left[ 1 - M_R \right] \right) \\
        &amp;= \frac{1}{M_R} \left( \frac{PC_0}{1 + PC_0} - \frac{PC(\theta)}{1 + PC_0} \right) \\
        &amp;= \frac{1}{M_R} \left( P \cdot \frac{C_0 - C(\theta)}{1 + PC_0} \right) \\
        &amp;= \frac{1}{M_R} P \cdot \left( C_0 - C(\theta) \right) \left( 1 - M_R \right)
\end{aligned}
\end{equation*}
</div>
<p>By subsituting this result back into <span class="math">\(J_{VR}\)</span> we obtain:</p>
<div class="math">
\begin{equation*}
J^N_{VR}(\theta) = E \left[ \left( \frac{L}{M_R} \cdot \left( C_0 - C(\theta) \right) \cdot \left( 1 - M_R \right) \right)^2 \right]
\end{equation*}
</div>
<p>The frequency-domain representation of this criterion is:</p>
<div class="math">
\begin{equation*}
J_{VR}(\theta) = \frac{1}{2\pi} \int_{-\pi}^{\pi} \left| P \cdot \left( C_0 - C(\theta) \right) \left( 1 - M_R \right) \cdot \frac{L}{M_R} \right|^2 \Phi_u \ d\omega
\end{equation*}
</div>
<p>Where, <span class="math">\(\Phi_u\)</span> is the power density of <span class="math">\(u(t)\)</span>.</p>
<p>If <span class="math">\(C_0(z) \in C(z; \theta)\)</span> and <span class="math">\(J_{VR}(\theta)\)</span> has a unique minimum then minimizing <span class="math">\(J_{VR}(\theta)\)</span> will always yield <span class="math">\({C_0(z)}\)</span> independently of the value of <span class="math">\(L(z)\)</span>.</p>
<p>Notice the similarity between the expressions of <span class="math">\(J_{MR}\)</span> and <span class="math">\(J_{VR}\)</span>. With a proper choice of the pre-filter <span class="math">\(L(z)\)</span> we can make them equal.</p>
<p>If:</p>
<div class="math">
\begin{equation*}
\left| L \right|^2 = \left| \frac{M_R W}{1 + PC(\theta)} \right|^2 \cdot \frac{1}{\Phi_u}
\end{equation*}
</div>
<p>Then,</p>
<div class="math">
\begin{equation*}
\begin{aligned}
    J_{VR}(\theta) &amp;= \frac{1}{2\pi} \int_{-\pi}^{\pi} \left| P \cdot \frac{C_0 - C(\theta)}{1 + PC_0} \cdot \frac{W}{1 + PC(\theta)} \right|^2 \ d\omega \\
                   &amp;= \frac{1}{2 \pi} \int_{-\pi}^{\pi} \left| P \cdot \frac{C(\theta) - C_0}{[1 + PC(\theta)][1 + PC_0]} \right|^2 \left| W \right|^2 \ d\omega = J_{MR}(\theta)
\end{aligned}
\end{equation*}
</div>
<p>Unfortunately this pre-filter is not practical since it depends on knowing the plant model <span class="math">\(P\)</span>. However, if <span class="math">\(C(z; \theta)\)</span> is a good approximation of <span class="math">\(C_0(z)\)</span> then:</p>
<div class="math">
\begin{equation*}
\left( 1 - M_R \right) = \frac{1}{1 + PC(z; \theta)} \approx \frac{1}{1 + PC_0(z)}
\end{equation*}
</div>
<p>Thus, <span class="math">\(L(z)\)</span> can be written as:</p>
<div class="math">
\begin{equation*}
L(z) = \left| \left(1 - M_R \right) \cdot M_R \cdot W \right|^2 \cdot \frac{1}{\Phi_u}
\end{equation*}
</div>
<p>This formulation of the pre-filter is completely known. This proves that <span class="math">\(J_{MR}\)</span> and <span class="math">\(J_{VR}\)</span> are equivalent and that by solving the simpler problem (<span class="math">\(J_{VR}\)</span>) we also solve the original problem (<span class="math">\(J_{MR}\)</span>).</p>
</div>
<div class="section" id="recap">
<h2>Recap</h2>
<p>In conclusion, the VRFT method can be broken down into a set of relatively simple steps:</p>
<ul class="simple">
<li>Choose a reference model <span class="math">\(M_R\)</span> and class of controllers <span class="math">\(C(z; \theta)\)</span></li>
<li>Calculate the pre-filter <span class="math">\(L(z)\)</span></li>
<li>Compute the optimal parameter vector <span class="math">\(\hat{\theta}_N\)</span></li>
</ul>
<p>The VRFT method can be extended to cases where the signal is noisy, we will discuss this in a later post. The VRFT method has also been extended to cascade control systems. This too will be the subject of a later post.</p>
</div>
<script type='text/javascript'>if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' }, Macros: {} }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
</section>
            </div>
                
        </div><!-- /.row -->
        
    </div><!-- /.container -->

    <!-- Footer -->
    <footer>
    	<div class="row">
            <!-- Blog Sidebar Widgets Column -->
            <div class="col-md-2 col-md-offset-4 col-sm-4 col-sm-offset-2">
                <ul class="list-unstyled text-right">
                    <li> 
                        <a href="/pages/cascade-vrft.html">
                            Cascade VRFT
                        </a>
                    </li>
                    <li> 
                        <a href="/pages/the-vrft-technique.html">
                            The VRFT Technique
                        </a>
                    </li>
                </ul>
            </div>

            <div class="col-md-2 col-sm-4">
                <ul class="list-unstyled">
                    <li>                                 
                        <a href="/None" type="application/atom+xml">
                            <i class="fa-rss"></i>
                            Atom Posts Feed
                        </a>
                    </li>
                    <li>                                 
                        <a href="/" type="application/rss+xml">
                            <i class="fa-rss"></i>
                            RSS Posts Feed
                        </a>
                    </li>
                </ul>
            </div>
        </div>


        <div class="row">
            <div class="col-lg-12">
                <p class="text-center">
					Powered by <a href="http://blog.getpelican.com/">Pelican</a> 	
                </p>               
            </div>
        </div>
        <!-- /.row -->
    </footer>


    <!-- jQuery -->
    <script src="/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>

</body>

</html>