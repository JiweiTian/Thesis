<!DOCTYPE html>
<html lang="">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" 
          content="	Title: Modelling is like plumbing; 
	Date: 2016-04-16; 
	Author: Tibo
">
    <meta name="author" content="Tibo">

    <title>	Modelling is like plumbing â€” Thesis Log
</title>

    <!-- Bootstrap Core CSS, Code Highlighting -->
    <link href="/theme/css/bootstrap.min.css" rel="stylesheet">
    <link href="/theme/css/pygments.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="/theme/css/theme.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <header class="clearfix"> 
        <section class="row">  	
            <h1 class="col-lg-8 col-lg-offset-2">
                <a href="" class="title-link">Thesis Log</a>
                <br>
                    <small class="subtitle"> Keeping myself in check</small>
            </h1>
        </section>

        <section class="row clearfix">
            <ul class="col-lg-8 col-lg-offset-2 list-unstyled">
                <li class="h5 pull-right">
                    <a href="/pages/cascade-vrft.html">Cascade VRFT</a>
                </li>
                <li class="h5 pull-right">
                    <a href="/pages/the-vrft-technique.html">The VRFT Technique</a>
                </li>
            </ul>
        </section>
    </header>

    <!-- Page Content -->
    <div class="container clearfix">

        <div class="row">
               
            <!-- Blog Post Content Column -->
            <div class="col-lg-8 col-lg-offset-2">
<article class="post" >
	<div class="post-header">
		<h2>Modelling is like plumbing</h2>

		<time datetime="2016-04-16T00:00:00+02:00" itemprop="datePublished">16 aprile 2016</time>
	</div>

	<div class="post-content">
		<p>After a small hiatus I'm back to work. THe aim today is to finish connecting the models together so that I can make the reference models. If all goes well I might even be able to run the VRFT.</p>
<p>So far I've redone all the calculations manually and I think I've figured how to plug the equations together.</p>
<p>The complete attitude model of the quad-copter is:</p>
<div class="math">
\begin{equation*}
I_n \dot{\omega}_b + \omega_b \times \left( I_n \omega_b \right) = M_{Damp} + M_{props}
\end{equation*}
</div>
<div class="math">
\begin{equation*}
M_{Damp} = \begin{bmatrix}
    \frac{\partial L}{\partial p} 0 0 \\
    0 \frac{\partial M}{\partial q} 0 \\
    0 0 \frac{\partial N}{\partial r}
\end{bmatrix} \cdot \begin{bmatrix}
    p \\ q \\ r
\end{bmatrix} \quad , \quad M_{Prop} = \begin{bmatrix}
    K_T \frac{b}{\sqrt{2}} \left( \Omega_1^2  - \Omega_2^2 - \Omega_3^2 + \Omega_4^2 \right) \\
    K_T \frac{b}{\sqrt{2}} \left( \Omega_1^2  + \Omega_2^2 - \Omega_3^2 - \Omega_4^2 \right) \\
    K_Q \left( -\Omega_1^2 + \Omega_2^2 - \Omega_3^2 + \Omega_4^2 \right)
\end{bmatrix}
\end{equation*}
</div>
<p>Since we are only considering the pitch dynamics of the quad-copter the model reduces to:</p>
<div class="math">
\begin{equation*}
I_{yy}\dot{q} + \left(I_{xx} - I_{zz} \right) pr= \frac{\partial M}{\partial q} q +  K_T \frac{b}{\sqrt{2}} \left( \Omega_1^2  + \Omega_2^2 - \Omega_3^2 - \Omega_4^2 \right)
\end{equation*}
</div>
<p>We constrain the speed of the two front and the two rear rotors to be the same</p>
<div class="math">
\begin{equation*}
\begin{aligned}
    \Omega_1 &amp;= \Omega_2 = \Omega_F \\
    \Omega_3 &amp;= \Omega_4 = \Omega_R,\
\end{aligned}
\end{equation*}
</div>
<p>This assumption reduces the model even further:</p>
<div class="math">
\begin{equation*}
\begin{aligned}
    I_{yy}\dot{q} + \left(I_{xx} - I_{zz} \right) pr
        &amp;= \frac{\partial M}{\partial q} q + K_T \frac{b}{\sqrt{2}} \left( \Omega_F^2  + \Omega_F^2 - \Omega_R^2 - \Omega_R^2 \right) \\
        &amp;= \frac{\partial M}{\partial q} q +  K_T b \sqrt{2} \left( \Omega_F^2 - \Omega_R^2 \right)
\end{aligned}
\end{equation*}
</div>
<p>We now linearize the model around hover conditions. The speed of the propellers in a perfect hover is <span class="math">\(\Omega_H\)</span>.</p>
<div class="math">
\begin{equation*}
\begin{alignedat}{4}
    \delta \Omega_F &amp;&amp;= \Omega_F - \Omega_H \quad &amp;&amp;\Rightarrow&amp;&amp; \quad \Omega_F &amp;&amp;= \delta \Omega_F + \Omega_H\\
    \delta \Omega_R &amp;&amp;= \Omega_R - \Omega_H \quad &amp;&amp;\Rightarrow&amp;&amp; \quad \Omega_R &amp;&amp;= \delta \Omega_R + \Omega_H\\
\end{alignedat}
\end{equation*}
</div>
<p>The control input <span class="math">\(u\)</span> is the variation in the speed of the propellers:</p>
<div class="math">
\begin{equation*}
u = \delta \Omega = \delta \Omega_F = -\delta \Omega_R
\end{equation*}
</div>
<p>The model is now reduced to:</p>
<div class="math">
\begin{equation*}
\begin{aligned}
    I_{yy}\dot{q} + \left(I_{xx} - I_{zz} \right) pr
        &amp;= \frac{\partial M}{\partial q} q + K_T 4 b \sqrt{2} \Omega_H \delta \Omega \\
        &amp;= \frac{\partial M}{\partial q} q + \frac{\partial M}{\partial u} \delta \Omega \ , \quad \frac{\partial M}{\partial u} = K_T 4 b \sqrt{2} \Omega_H
\end{aligned}
\end{equation*}
</div>
<p>It also trivial to show from here that the pitch term of the mixer matrix is simply:</p>
<div class="math">
\begin{equation*}
\delta \Omega = \left( \frac{\partial M}{\partial u} \right)^{-1} \delta M
\end{equation*}
</div>
<p>From here we can start plumbing.</p>
<p>This allowed me to write the equations for the entire control system. Unfortunately the transfer functions feel off. They look faster than what I expected and don't really match up with the graphs I was able to find in the paper.</p>
<p>The next step to verify the data would be to simulate the entire thing and see if the data that comes out looks like anything in the thesis. Once I'm confident that the models I have on paper line up with the thesis results I'll run the actual VRFT and compare the controller values.</p>
<p>All this work is implemented in  <a class="reference external" href="/static/04-16/quad_copter_mlx.html">this</a> mlx file.</p>
<script type='text/javascript'>if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' }, Macros: {} }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
	</div> 

</article>
            </div>
                
        </div><!-- /.row -->
        
    </div><!-- /.container -->

    <!-- Footer -->
    <footer>
    	<div class="row">
            <!-- Blog Sidebar Widgets Column -->
            <div class="col-md-2 col-md-offset-4 col-sm-4 col-sm-offset-2">
                <ul class="list-unstyled text-right">
                    <li> 
                        <a href="/pages/cascade-vrft.html">
                            Cascade VRFT
                        </a>
                    </li>
                    <li> 
                        <a href="/pages/the-vrft-technique.html">
                            The VRFT Technique
                        </a>
                    </li>
                </ul>
            </div>

            <div class="col-md-2 col-sm-4">
                <ul class="list-unstyled">
                    <li>                                 
                        <a href="/None" type="application/atom+xml">
                            <i class="fa-rss"></i>
                            Atom Posts Feed
                        </a>
                    </li>
                    <li>                                 
                        <a href="/" type="application/rss+xml">
                            <i class="fa-rss"></i>
                            RSS Posts Feed
                        </a>
                    </li>
                </ul>
            </div>
        </div>


        <div class="row">
            <div class="col-lg-12">
                <p class="text-center">
					Powered by <a href="http://blog.getpelican.com/">Pelican</a> 	
                </p>               
            </div>
        </div>
        <!-- /.row -->
    </footer>


    <!-- jQuery -->
    <script src="/theme/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>

</body>

</html>