Discrete systems theory
=======================

:date: 2016-03-17

Definitions
***********

Consider the general form of a discrete time system: 

.. math::

    \begin{aligned}
        x\left( k+1 \right) &= f\left( x\left( k \right), u\left( k \right), k \right) \\
                       y(k) &= g\left( x\left( k \right), u\left( k \right), k \right)
    \end{aligned}

Strictly proper systems
-----------------------

If the output equation of the system can be written as :math:`y(k) = g\left( x\left( k \right), k \right)` then the output variable des not depend directly on the input and the system is *strictly proper*. The input must propagate through the state before affecting the output.

Time Invariant systems (Stationary)
-----------------------------------

If the functions :math:`f` and :math:`g` do not explicitely depend on the time variable $k$ then the system is time invariant and can be rewritten as: 
 
.. math::
    \begin{aligned}
        x\left( k+1 \right) &= f\left( x\left( k \right), u\left( k \right) \right) \\
                       y(k) &= g\left( x\left( k \right), u\left( k \right) \right)
    \end{aligned}

Reachability (Controllability)
------------------------------

A generic state :math:`\widetilde{x}` is reachable if there exist an instant of time :math:`\widetilde{k}`and an input sequence $\widetilde{u}$ defined from :math:`0` to :math:`\widetilde{k} - 1` such that the forced state of the system :math:`\widetilde{x}_f(k)` with :math:`0 \leq k  \leq \widetilde{k}` generated by :math:`\widetilde{u}` produces :math:`\widetilde{x}_f(k) = \widetilde{x}`    .

The **Reachability Matrix** is:

.. math::

    \underline{M}_R = \begin{bmatrix}B \quad AB \quad A^2B \quad ... \quad A^{n-1}B\end{bmatrix}

Observability 
-------------

A state :math:`\widetilde{x} \neq 0` is said to be *non observable* if, for any :math:`\widetilde{k} > 0` the free motion of the system :math:`\widetilde{y}_l(k) = 0` with :math:`0 \leq k \leq \widetilde{k}`.

The **Observability Matrix** is: 

.. math::

    \underline{M}_O = \begin{bmatrix}
        C \\ 
        CA \\
        CA^2 \\ 
        \vdots \\
        CA^{n-1}
    \end{bmatrix}

Transfer function
-----------------

The general form of the transfer function for a discrete time system is: 

.. math::

    G(z) = C(zI - A)^{-1}B + D

By construction :math:`C(zI - A)^{-1}B` is a rational function in $z$ where the denominator is of degree $n$ and the numerator's  degree is at most :math:`n-1`. This is the form of a strictly proper system (:math:`D = 0`).

If the system is not proper :math:`G(z)` is still a rational function in z but both the numerator and the denominator have degree :math:`n`.

If the numerator and the denominator have common roots they must cancel each other out to produce a rational function whose degree is :math:`\nu \lt n`

The transfer function can be written as: 

.. math::

    G(z) = \frac{N_G(z)}{D_G(z)} = \frac{\beta_{\nu}z^{\nu} + \beta_{\nu-1}z^{\nu-1} + ... + \beta_1z + \beta_0}{\alpha_{\nu}z^{\nu} + \alpha_{\nu-1}z^{\nu-1} + ... + \alpha_1z + \alpha_0}

Without losing in generality we can assume :math:`\alpha_{\nu} = 1`. 

Time Delay
-----------

A time discrete time delay is described by the following input-output form:

.. math::

    y(k) = u(k-h) \Leftrightarrow Y(z) = z^{-h}U(z)

Thus the tranfer function associated with the delay component is :math:`G(z) = z^{-h}`

Considering a system where the action of the input is delayed by :math:`h` ticks such as: 

.. math::

    \begin{aligned}
        v(k) &= u(k-h)\\
        x(k+1) &= Ax(k) + Bu(k) \\
        y(k) &= Cx(k) + Du(k)
    \end{aligned}

It can be show that the transfer function is: 

.. math::

    G(z) = z^{-h}G'(z) \qquad, \qquad G'(z) = C(zI - A)^{-1}B + D

Frequency Response
------------------

The frequency response of the transfer function is calculated as: 

.. math::

    G(e^{j\theta}) = C(e^{j\theta}I - A)^{-1}B + D \qquad, \qquad \theta \in \left[0, \pi \right]

This is simply a restriction of the transfer function to the semi-circumference defined by the complex points with positive or null immaginary part and unit modulus excluding those points that are also poles of :math:`G(z)`.

Settling Time
-------------

Consider a first order system: 

.. math::

    G(z) = \frac{\mu(1-p)}{z-p} \qquad, \qquad p \neq 0

The step response of this system is:

.. math::

    y(k) = \mu(1-p^k) \qquad, \qquad k \geq 0

And the steady state value is :math:`y_{\infty} = \mu`.

The settling time of the system is the time it takes to output variable to enter the range :math:`\left[y_{\infty}(1 - 0.01\epsilon), \quad y_{\infty}(1 - 0.01\epsilon) \right]`

.. math::

    \begin{alignedat}{3}
        &            y_{\infty}(1 - 0.01\varepsilon) && \leq (1-p^k)  &&< y_{\infty}(1+ 0.01\varepsilon) \\
        &\frac{y_{\infty}}{\mu}(1 - 0.01\varepsilon) && \leq  1-p^k   &&< \frac{y_{\infty}}{\mu}(1+ 0.01\varepsilon) \\
        &                          (1 - 0.01\varepsilon) && \leq  1-p^k   &&< (1+ 0.01\varepsilon) \\
        &                               -0.01\varepsilon && \leq    p^k   &&< 0.01\varepsilon \\
    \end{alignedat}

Which can be traslated into the following requirement: 

.. math ::

    k \cdot ln(p) < ln(0.01\varepsilon) \qquad \Rightarrow  \qquad k < \frac{ln(0.01\varepsilon)}{p}


Thus, the settling time is:

.. math::

    T_{a\epsilon} = \lceil \frac{ln(0.01\varepsilon)}{ln(p)} \rceil

Consider now a second order system with complex conjugate poles:

.. math ::

    G(s) = \frac{\mu \omega^2_n}{s^2 + 2\zeta\omega_ns + \omega^2_n}

This system has ann oscillatory behaviour and the peaks of the oscillations lie on 2 decaying exponentials:

.. math::

    y_{max}(t) = 1 + e^{-\zeta\omega_nt}
    y_{min}(t) = 1 - e^{-\zeta\omega_nt}

Let :math:`\bar{t}` be the instant in which the function :math:`y_{max}` and :math:`y_{min}` enter the range :math:`\left[ y_{\infty}(1 - 0.01\epsilon), \quad y_{\infty}(1 - 0.01\epsilon) \right]`. To determine :math:`\bar{t}` we simply impose: 

.. math::
    
    \begin{aligned}
        1 + 0.01\varepsilon &= 1 + e^{-\zeta\omega_n\bar{t}} \\
            0.01\varepsilon &= e^{-\zeta\omega_n\bar{t}} \\
                    \bar{t} &= -\frac{1}{\zeta\omega_n} ln(0.01\varepsilon) \approx \frac{4.6}{\zeta\omega_n}                    
    \end{aligned}





Next steps
**********

If today showed me anything is that I don't know shit about designing discrete time control systems. The best thing to do is to stick with what I know: use the requirements to produce a continuous time reference model that I can discretize with `c2d`. 

I'll just have to check its performance to make sure that everything is OK but that should be enough. 
