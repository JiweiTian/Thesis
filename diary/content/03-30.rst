More Theory
===========

:date: 2016-03-30

I got off to a late start today due to some conferences I wanted to attend in Leonardo. I've spent most of time so far copy-editing the main VRFT explanation page (``VRFT.rst``) and making tikz illustrations for the control scheme. 

I think I understand the cascade control algoithm ! 

The cascade control algorithm:
------------------------------

.. figure:: {filename}/static/03-30/cascade_vrft_block_diagram.jpg
    :align: center
    :alt: A block diagram of the cascade VRFT control scheme

In the cascade algorithm we assume that we have output measurements of the inner and outer plants :math:`y_i(t)` and :math:`y_o(t)` for a given input signal :math:`u(t)`. We start by applying VRFT to the inner loop with the usual method: 

.. code-block:: matlab

    InnerController = VRFT1_dy(u, y_i, InnerRefModel, InnerControllerFamily);  

The difficulty is performing VRFT on the outer loop. To do this we would need to know the output of the first controller. Fortunately, now that we have the inner controller we can calculate it. 

We know that: 

.. math::

    \begin{aligned}
        e_i(t) &= r_i(t) - y_i(t) \\
               &= C_i^{-1} u(t)
    \end{aligned}

We can only invert :math:`C_i` if it is minium phase. If it isn't minimum phase we need to choose a different reference model or the sampling time. 

Now that :math:`e_i(t)` is known we can retirieve :math:`r_i(t)`:

.. math::

    \begin{aligned}
        r_i(t) &= e_i(t) + y_i(t) = C_i^{-1}u(t) + y_i(t) \\
               &= u_o(t)
    \end{aligned}

From here the solution is quite trivial:

.. code:: matlab

    OuterController = VRFT1_dy(u_o, y_o, OuterRefModel, OuterControllerFamily);




